
<!DOCTYPE html>
<!--pqGrid Work-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--jQuery dependencies-->
    <link rel="stylesheet"
          href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/base/jquery-ui.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>


    <!--Include Touch Punch file to provide support for touch devices
    <script type="text/javascript" src="path to touch-punch.js" ></script> -->

    <!--ParamQuery Grid files-->
    <link rel="stylesheet" href="./pqgrid.min.css" />
    <script type="text/javascript" src="./pqgrid.min.js" ></script>

    <script src="./handsontable/dist/handsontable.full.min.js"></script>
    <link href="./handsontable/dist/handsontable.full.min.css" rel="stylesheet" media="screen">


<style>
.red {
    color: yellow;

}

</style>


    <script>
        //import {getCell} from "./handsontable/test/helpers/common";

        function initC(idStr,colStr,l,w,t,h) {
            $("#"+idStr).css({

                "background-color":colStr,
                "position":"absolute",
                "left":l+"%",
                "width":w+"%",
                "top":t+"%",
                "height":h+"%",
                "visibility": "visible",
                "box-sizing":"border-box",
                "border-style":"none"
            })
        }

        function updateSheet(){
            //test update
            alert(data2[0][0] * data2[0][4]);
            data2[1][1] = 6;


            //$(cell).removeClass();
            //$(cell).toggleClass("myborder");

            var className = 'red';


            $( "#grid_array" ).pqGrid( "addClass", {rowIndx: 2, dataIndx:2, cls: className} );
           // $( "#grid_array" ).pqGrid( "removeClass", {rowIndx: 2, dataIndx:2, cls: 'red'} );


            $( "#grid_array" ).pqGrid( "refresh" );
           // var cell = $("#grid_array").pqGrid( "getCell", {rowIndx: 2,colIndx: 3} );
            //$(cell).css({ "border-top": "5px solid #ff0000", "border-bottom": "5px solid #ff0000","background-color":"blue" });

            text = 'Some data I want to export';
            var data = new Blob([text], {type: 'text/plain'});

            var url = window.URL.createObjectURL(data);


            $( ".#grid_array" ).pqGrid( "exportCsv", { url: url } );


            document.getElementById('download_link').href = url;


        }

        // effectively global state variables
        var nRows =50;
        var nColumns = 4;
        var data =[];
        var data2 =[];
        var data4 =[];







        $(function(){

            initC("mainPanel1", "Blue", 0, 100, 0, 50);
            initC("button1","Red", 2,10,94,5);
            initC("download_link","Black",50,30,90,10);
            initC("example","Green",0,100,60,30);
            initC("export-file","Yellow", 40,10,65,10);

            var data3 = [
                ['', 'Ford', 'Tesla', 'Toyota', 'Honda'],
                ['2017', 10, 11, 12, 13],
                ['2018', 20, 11, 14, 13],
                ['2019', 30, 15, 12, 13]
            ];



            /*
            var data = [ [1,'Exxon Mobil','339,938.0','36,130.0'],
                [2,'Wal-Mart Stores','315,654.0','11,231.0'],
                [3,'Royal Dutch Shell','306,731.0','25,311.0'],
                [4,'BP','267,600.0','22,341.0'],
                [5,'General Motors','192,604.0','-10,567.0'],
                [6,'Chevron','189,481.0','14,099.0'],
                [7,'DaimlerChrysler','186,106.3','3,536.3'],
                [8,'Toyota Motor','185,805.0','12,119.6'],
                [9,'Ford Motor','177,210.0','2,024.0'],
                [10,'ConocoPhillips','166,683.0','13,529.0'],
                [11,'General Electric','157,153.0','16,353.0'],
                [12,'Total','152,360.7','15,250.0'],
                [13,'ING Group','138,235.3','8,958.9'],
                [14,'Citigroup','131,045.0','24,589.0'],
                [15,'AXA','129,839.2','5,186.5'],
                [16,'Allianz','121,406.0','5,442.4'],
                [17,'Volkswagen','118,376.6','1,391.7'],
                [18,'Fortis','112,351.4','4,896.3'],
                [19,'Crédit Agricole','110,764.6','7,434.3'],
                [20,'American Intl. Group','108,905.0','10,477.0']];

            */
            const IX =0;
            const TYPE =1;
            const COND1 =2;
            const MESSAGE =3;
            const SP =4;
            const BALANCE =5;
            const ACTIVITY =6;
            const BID0 = 7;
            const BID_1 = 8;
            const BID_2 =9;
            const BID_3 =10;


            for(var i = 0;i <nRows;i++) {
                data2[i] = [];
                data2[i][IX] = i;
                data2[i][TYPE] = "TEST";
                data2[i][COND1] = "1###0111";
                data2[i][MESSAGE] = "10101010";
               data2[i][SP] = 0.1;
                data2[i][BALANCE] = 100.00;
                data2[i][ACTIVITY] = "STOP";
                data2[i][BID0] =10.0;
                data2[i][BID_1] = 9.999;
                data2[i][BID_2] = 9.998;
                data2[i][BID_3] = 9.997;

            }

            for(var i = 0;i <nRows;i++) {
                data4[i] = [];
                data4[i][IX] = i;
                data4[i][TYPE] = "TEST";
                data4[i][COND1] = "1###0111";
                data4[i][MESSAGE] = "10101010";
                data4[i][SP] = 0.1;
                data4[i][BALANCE] = 100.00;
                data4[i][ACTIVITY] = "STOP";
                data4[i][BID0] =10.0;
                data4[i][BID_1] = 9.999;
                data4[i][BID_2] = 9.998;
                data4[i][BID_3] = 9.997;

            }





        for(var i = 0;i <nRows;i++) {
            data[i] = [];

            for (var j = 0; j < nColumns; j++) {

                data[i][j] = 100*i +j;

            }
        }







            var obj = {};
            obj.width = 1200;
            obj.height = 400;
            obj.resizable = true;
            obj.title = "test";
            obj.toolbar = toolbar;
            obj.editModel = {clicksToEdit:2};
            obj.colModel = [{title:"IX", width:100, dataType:"integer"},
                {title:"TYPE", width:100, dataType:"string"},
                {title:"COND1", width:100, dataType:"string"},
                {title:"MESSAGE", width:100, dataType:"string"},
                {title:"SP", width:100, dataType:"float"},
                {title:"BALANCE", width:100, dataType:"float"},
                {title:"ACTIVITY", width:100, dataType:"string"},
                {title:"BID0", width:100, dataType:"float"},
                {title:"BID_1", width:100, dataType:"float"},
                {title:"BID_2", width:100, dataType:"float"},
                {title:"BID_3", width:100, dataType:"float"}
            ];
            obj.dataModel = {data:data2};



            $("#grid_array").pqGrid( obj );

            var container = document.getElementById('example');
            var hot = new Handsontable(container, {
                data: data4,
                rowHeaders: true,
                colHeaders: false,
                filters: true,
                dropdownMenu: true,
                width:'50%',
                height:'30%',

                licenseKey: 'non-commercial-and-evaluation'
            });

            var myCell = hot.getCell(2,2);


            myCell.style.backgroundColor = "Blue";
            myCell.className = "red";


            var button1 = document.getElementById('export-file');
            var exportPlugin1 = hot.getPlugin('exportFile');

            button1.addEventListener('click', function() {
                var myCell = hot.getCell(36,2);

                var myVal = hot.getDataAtCell(3,3);

                alert(myVal);

             hot.setCellMeta(3,3,"color","Blue");




               // myCell.style.backgroundColor = "Blue";

                /*
                exportPlugin1.downloadFile('csv', {
                    bom: false,
                    columnDelimiter: ',',
                    columnHeaders: false,
                    exportHiddenColumns: true,
                    exportHiddenRows: true,
                    fileExtension: 'csv',
                    filename: 'HandsontableFile',
                    mimeType: 'text/csv',
                    rowDelimiter: '\r\n',
                    rowHeaders: true
                });


                 */
            });




        });
    </script>





</head>
<body>
<div id="mainPanel1" ></div>
<div id="grid_array"></div>
<button id="button1" type="button" onclick="updateSheet()">Update</button>
<a id="download_link" download="my_exported_file2.txt" href=”” >Download as Text File</a>
<div id="example"></div>
<button id="export-file" >Download CSV</button>
</body>
</html>